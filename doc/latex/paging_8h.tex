\hypertarget{paging_8h}{\section{kernel/inc/mm/paging.h File Reference}
\label{paging_8h}\index{kernel/inc/mm/paging.\-h@{kernel/inc/mm/paging.\-h}}
}
{\ttfamily \#include $<$types.\-h$>$}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void $\ast$ \hyperlink{paging_8h_a0692bf8dce3ee5883abdba6625491437}{alloc\-\_\-frame} ()
\item 
void \hyperlink{paging_8h_ad92096aea0b75ba3e87fc927bf83ccc4}{free\-\_\-frame} (void $\ast$)
\item 
void \hyperlink{paging_8h_a6156a7180bf5e5125ca71bad5dffb617}{clear\-\_\-pagedir} (\hyperlink{types_8h_a10e94b422ef0c20dcdec20d31a1f5049}{u32} $\ast$)
\item 
void \hyperlink{paging_8h_a4460313a902a5884ba774692e3197218}{fill\-\_\-pagetable} (\hyperlink{types_8h_a10e94b422ef0c20dcdec20d31a1f5049}{u32} $\ast$, \hyperlink{types_8h_a10e94b422ef0c20dcdec20d31a1f5049}{u32})
\item 
void \hyperlink{paging_8h_add2d43ae44908f87b59d65159e7736cd}{set\-\_\-pagedir} (\hyperlink{types_8h_a10e94b422ef0c20dcdec20d31a1f5049}{u32} $\ast$)
\item 
void \hyperlink{paging_8h_ae62af42af2d4cb211a64978ff1ef060e}{enable\-\_\-paging} ()
\item 
void \hyperlink{paging_8h_a65805eac601918e3f84e052063dac28b}{disable\-\_\-paging} ()
\item 
void \hyperlink{paging_8h_a569adfd13ea3c63741f64108821b1712}{paging\-\_\-init} ()
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{paging_8h_a0692bf8dce3ee5883abdba6625491437}{\index{paging.\-h@{paging.\-h}!alloc\-\_\-frame@{alloc\-\_\-frame}}
\index{alloc\-\_\-frame@{alloc\-\_\-frame}!paging.h@{paging.\-h}}
\subsubsection[{alloc\-\_\-frame}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ alloc\-\_\-frame (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{paging_8h_a0692bf8dce3ee5883abdba6625491437}


Definition at line 41 of file paging.\-c.



References get\-\_\-free\-\_\-frame(), and prealloc\-\_\-frames.


\begin{DoxyCode}
42 \{
43         \textcolor{keyword}{static} \hyperlink{types_8h_a10e94b422ef0c20dcdec20d31a1f5049}{u32} pframe = 20;
44  
45         \textcolor{keywordflow}{if}(pframe == 20)
46         \{
47             \textcolor{keywordtype}{int} i = 0;
48             \textcolor{keywordflow}{for}(; i < 20; i++)
49             \{
50                 \hyperlink{paging_8c_a3664686d7e92f0bca2061d088362f3d8}{prealloc\_frames}[i] = (\hyperlink{types_8h_a10e94b422ef0c20dcdec20d31a1f5049}{u32})\hyperlink{paging_8c_a4e8b2a17d9a96f0148b6a3b249669c2c}{get\_free\_frame}();
51                 \textcolor{keywordflow}{if}(\hyperlink{paging_8c_a3664686d7e92f0bca2061d088362f3d8}{prealloc\_frames}[i] == 0xFFFFFFFF) \textcolor{keywordflow}{return} (\textcolor{keywordtype}{void} *)0xFFFFFFFF; \textcolor{comment}{// TODO: Add
       some type of handling system here}
52             \}
53             pframe = 0;
54         \}
55         \textcolor{keywordflow}{return} (\textcolor{keywordtype}{void} *)\hyperlink{paging_8c_a3664686d7e92f0bca2061d088362f3d8}{prealloc\_frames}[pframe++];
56 \}
\end{DoxyCode}
\hypertarget{paging_8h_a6156a7180bf5e5125ca71bad5dffb617}{\index{paging.\-h@{paging.\-h}!clear\-\_\-pagedir@{clear\-\_\-pagedir}}
\index{clear\-\_\-pagedir@{clear\-\_\-pagedir}!paging.h@{paging.\-h}}
\subsubsection[{clear\-\_\-pagedir}]{\setlength{\rightskip}{0pt plus 5cm}void clear\-\_\-pagedir (
\begin{DoxyParamCaption}
\item[{{\bf u32} $\ast$}]{}
\end{DoxyParamCaption}
)}}\label{paging_8h_a6156a7180bf5e5125ca71bad5dffb617}


Definition at line 71 of file paging.\-c.


\begin{DoxyCode}
72 \{
73     \textcolor{keywordtype}{int} i = 0;
74     \textcolor{keywordflow}{for}(i = 0; i < 1024; i++)
75         dir[i] = 2; \textcolor{comment}{// supervisor, rw, not present.}
76 \}
\end{DoxyCode}
\hypertarget{paging_8h_a65805eac601918e3f84e052063dac28b}{\index{paging.\-h@{paging.\-h}!disable\-\_\-paging@{disable\-\_\-paging}}
\index{disable\-\_\-paging@{disable\-\_\-paging}!paging.h@{paging.\-h}}
\subsubsection[{disable\-\_\-paging}]{\setlength{\rightskip}{0pt plus 5cm}void disable\-\_\-paging (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{paging_8h_a65805eac601918e3f84e052063dac28b}


Definition at line 100 of file paging.\-c.


\begin{DoxyCode}
101 \{
102     \hyperlink{types_8h_a10e94b422ef0c20dcdec20d31a1f5049}{u32} cr0;
103     \textcolor{keyword}{asm} \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"mov %%cr0, %0"}: \textcolor{stringliteral}{"=b"}(cr0));
104     cr0 &= ~0x80000000;
105     \textcolor{keyword}{asm} \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"mov %0, %%cr0"}:: \textcolor{stringliteral}{"b"}(cr0));
106 \}
\end{DoxyCode}
\hypertarget{paging_8h_ae62af42af2d4cb211a64978ff1ef060e}{\index{paging.\-h@{paging.\-h}!enable\-\_\-paging@{enable\-\_\-paging}}
\index{enable\-\_\-paging@{enable\-\_\-paging}!paging.h@{paging.\-h}}
\subsubsection[{enable\-\_\-paging}]{\setlength{\rightskip}{0pt plus 5cm}void enable\-\_\-paging (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{paging_8h_ae62af42af2d4cb211a64978ff1ef060e}


Definition at line 92 of file paging.\-c.


\begin{DoxyCode}
93 \{
94     \hyperlink{types_8h_a10e94b422ef0c20dcdec20d31a1f5049}{u32} cr0;
95     \textcolor{keyword}{asm} \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"mov %%cr0, %0"}: \textcolor{stringliteral}{"=b"}(cr0));
96     cr0 |= 0x80000000;
97     \textcolor{keyword}{asm} \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"mov %0, %%cr0"}:: \textcolor{stringliteral}{"b"}(cr0));
98 \}
\end{DoxyCode}
\hypertarget{paging_8h_a4460313a902a5884ba774692e3197218}{\index{paging.\-h@{paging.\-h}!fill\-\_\-pagetable@{fill\-\_\-pagetable}}
\index{fill\-\_\-pagetable@{fill\-\_\-pagetable}!paging.h@{paging.\-h}}
\subsubsection[{fill\-\_\-pagetable}]{\setlength{\rightskip}{0pt plus 5cm}void fill\-\_\-pagetable (
\begin{DoxyParamCaption}
\item[{{\bf u32} $\ast$}]{, }
\item[{{\bf u32}}]{}
\end{DoxyParamCaption}
)}}\label{paging_8h_a4460313a902a5884ba774692e3197218}


Definition at line 79 of file paging.\-c.


\begin{DoxyCode}
80 \{
81     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i;
82     \textcolor{keywordflow}{for}(i = 0; i < 1024; i++, addr += 0x1000)
83         table[i] = addr | 3;  \textcolor{comment}{// supervisor, rw, present.}
84 \}
\end{DoxyCode}
\hypertarget{paging_8h_ad92096aea0b75ba3e87fc927bf83ccc4}{\index{paging.\-h@{paging.\-h}!free\-\_\-frame@{free\-\_\-frame}}
\index{free\-\_\-frame@{free\-\_\-frame}!paging.h@{paging.\-h}}
\subsubsection[{free\-\_\-frame}]{\setlength{\rightskip}{0pt plus 5cm}void free\-\_\-frame (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{}
\end{DoxyParamCaption}
)}}\label{paging_8h_ad92096aea0b75ba3e87fc927bf83ccc4}


Definition at line 58 of file paging.\-c.



References firstframe, and set\-\_\-frame().


\begin{DoxyCode}
59 \{
60     \hyperlink{types_8h_a10e94b422ef0c20dcdec20d31a1f5049}{u32} f = (\hyperlink{types_8h_a10e94b422ef0c20dcdec20d31a1f5049}{u32})frame;
61     f -= (\hyperlink{types_8h_a10e94b422ef0c20dcdec20d31a1f5049}{u32})\hyperlink{paging_8c_addbce032f1a6b8fed9b601bbaa43d7be}{firstframe};
62     f /= 0x1000;
63     \hyperlink{paging_8c_a65d86d5522174b72c52f3c08c848e770}{set\_frame}(f, 0);
64 \}
\end{DoxyCode}
\hypertarget{paging_8h_a569adfd13ea3c63741f64108821b1712}{\index{paging.\-h@{paging.\-h}!paging\-\_\-init@{paging\-\_\-init}}
\index{paging\-\_\-init@{paging\-\_\-init}!paging.h@{paging.\-h}}
\subsubsection[{paging\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void paging\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{paging_8h_a569adfd13ea3c63741f64108821b1712}


Definition at line 110 of file paging.\-c.



References clear\-\_\-pagedir(), enable\-\_\-paging(), fill\-\_\-pagetable(), firstframe, frames, kern\-\_\-end, nframes, pagedir, pagetbl1, and set\-\_\-pagedir().


\begin{DoxyCode}
111 \{
112     \hyperlink{paging_8c_a01d74d2dec403b67edcbc35310419b54}{pagedir} = (\hyperlink{types_8h_a10e94b422ef0c20dcdec20d31a1f5049}{u32} *)(((\hyperlink{types_8h_a10e94b422ef0c20dcdec20d31a1f5049}{u32})&\hyperlink{paging_8c_a95f05feb6b1c576f3d83a427f5cd082d}{kern\_end} & 0xFFFFF000) + 0x1000);
113     \hyperlink{paging_8c_a78ee631b14ab62b76384e0eec3680ccb}{pagetbl1} = \hyperlink{paging_8c_a01d74d2dec403b67edcbc35310419b54}{pagedir} + 1024;
114 
115     \hyperlink{paging_8c_addbce032f1a6b8fed9b601bbaa43d7be}{firstframe} = (\hyperlink{paging_8c_a78ee631b14ab62b76384e0eec3680ccb}{pagetbl1} + 0x8000); \textcolor{comment}{// Make sure if is a fair distance away from kernel
       paging structures}
116 
117     \textcolor{keywordtype}{int} end\_mem = 0x1000000; \textcolor{comment}{// Temporary}
118     \hyperlink{paging_8c_a3337b35daceb6ab9c5edf3bf526e469a}{nframes} = end\_mem / 0x1000;
119     \hyperlink{types_8h_a10e94b422ef0c20dcdec20d31a1f5049}{u32} i = 0;
120     \textcolor{keywordflow}{for}(; i < \hyperlink{paging_8c_a3337b35daceb6ab9c5edf3bf526e469a}{nframes}; i++, \hyperlink{paging_8c_a247734b0af2e71834b2ddc3523ffa0fa}{frames}[i] = 0);
121 
122     \hyperlink{paging_8h_a6156a7180bf5e5125ca71bad5dffb617}{clear\_pagedir}(\hyperlink{paging_8c_a01d74d2dec403b67edcbc35310419b54}{pagedir});
123     \hyperlink{paging_8h_a4460313a902a5884ba774692e3197218}{fill\_pagetable}(\hyperlink{paging_8c_a78ee631b14ab62b76384e0eec3680ccb}{pagetbl1}, 0x00000000);
124     \hyperlink{paging_8c_a01d74d2dec403b67edcbc35310419b54}{pagedir}[0] = (\hyperlink{types_8h_a10e94b422ef0c20dcdec20d31a1f5049}{u32})\hyperlink{paging_8c_a78ee631b14ab62b76384e0eec3680ccb}{pagetbl1} | 3; \textcolor{comment}{// supervisor, rw, present}
125 
126     \hyperlink{paging_8h_add2d43ae44908f87b59d65159e7736cd}{set\_pagedir}(\hyperlink{paging_8c_a01d74d2dec403b67edcbc35310419b54}{pagedir});
127     \hyperlink{paging_8h_ae62af42af2d4cb211a64978ff1ef060e}{enable\_paging}();
128 \}\end{DoxyCode}
\hypertarget{paging_8h_add2d43ae44908f87b59d65159e7736cd}{\index{paging.\-h@{paging.\-h}!set\-\_\-pagedir@{set\-\_\-pagedir}}
\index{set\-\_\-pagedir@{set\-\_\-pagedir}!paging.h@{paging.\-h}}
\subsubsection[{set\-\_\-pagedir}]{\setlength{\rightskip}{0pt plus 5cm}void set\-\_\-pagedir (
\begin{DoxyParamCaption}
\item[{{\bf u32} $\ast$}]{}
\end{DoxyParamCaption}
)}}\label{paging_8h_add2d43ae44908f87b59d65159e7736cd}


Definition at line 87 of file paging.\-c.


\begin{DoxyCode}
88 \{
89     \textcolor{keyword}{asm} \textcolor{keyword}{volatile}(\textcolor{stringliteral}{"mov %0, %%cr3"}:: \textcolor{stringliteral}{"b"}(dir));
90 \}
\end{DoxyCode}
