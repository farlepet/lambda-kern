<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Lambda OS: kernel/arch/x86/mm/paging.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Lambda OS
   </div>
   <div id="projectbrief">HobbyoperatingsystemcreatedinC</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('paging_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">paging.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="multiboot_8h_source.html">multiboot.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="error_8h_source.html">err/error.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="int_8h_source.html">intr/int.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="string_8h_source.html">string.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="paging_8h_source.html">paging.h</a>&quot;</code><br/>
<code>#include &lt;<a class="el" href="types_8h_source.html">types.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="video_8h_source.html">video.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="mem_8h_source.html">mem.h</a>&quot;</code><br/>
</div>
<p><a href="paging_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structalloc__head.html">alloc_head</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt; Header for allocated blocks  <a href="structalloc__head.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:acaa325523bd17bffb8ee5a2681b0a0b3"><td class="memItemLeft" align="right" valign="top">static u32 pagedir[1024]&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#acaa325523bd17bffb8ee5a2681b0a0b3">__align</a> (0x1000)</td></tr>
<tr class="memdesc:acaa325523bd17bffb8ee5a2681b0a0b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main kernel pagedirectory.  <a href="#acaa325523bd17bffb8ee5a2681b0a0b3">More...</a><br/></td></tr>
<tr class="separator:acaa325523bd17bffb8ee5a2681b0a0b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65d86d5522174b72c52f3c08c848e770"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#a65d86d5522174b72c52f3c08c848e770">set_frame</a> (u32 frame, u32 val)</td></tr>
<tr class="separator:a65d86d5522174b72c52f3c08c848e770"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef6922a09d5cc385e2f616ea32259fba"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#aef6922a09d5cc385e2f616ea32259fba">block_page</a> (u32 page)</td></tr>
<tr class="separator:aef6922a09d5cc385e2f616ea32259fba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec230565edc62c3911800334ba8357bb"><td class="memItemLeft" align="right" valign="top">static u32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#aec230565edc62c3911800334ba8357bb">test_frame</a> (u32 frame)</td></tr>
<tr class="separator:aec230565edc62c3911800334ba8357bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e8b2a17d9a96f0148b6a3b249669c2c"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#a4e8b2a17d9a96f0148b6a3b249669c2c">get_free_frame</a> ()</td></tr>
<tr class="separator:a4e8b2a17d9a96f0148b6a3b249669c2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0692bf8dce3ee5883abdba6625491437"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#a0692bf8dce3ee5883abdba6625491437">alloc_frame</a> ()</td></tr>
<tr class="memdesc:a0692bf8dce3ee5883abdba6625491437"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate a frame. Allocates a page frame then returns its address.  <a href="#a0692bf8dce3ee5883abdba6625491437">More...</a><br/></td></tr>
<tr class="separator:a0692bf8dce3ee5883abdba6625491437"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae46f6fc37cc817eba111627d8966d49d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#ae46f6fc37cc817eba111627d8966d49d">map_page</a> (void *physaddr, void *virtualaddr, u32 flags)</td></tr>
<tr class="memdesc:ae46f6fc37cc817eba111627d8966d49d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Map a virtual address to a physical one. Map a virtual address to a physical one.  <a href="#ae46f6fc37cc817eba111627d8966d49d">More...</a><br/></td></tr>
<tr class="separator:ae46f6fc37cc817eba111627d8966d49d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84f2e5bf7896e25c26ba9e0ea4a70715"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#a84f2e5bf7896e25c26ba9e0ea4a70715">free_frame</a> (void *frame)</td></tr>
<tr class="memdesc:a84f2e5bf7896e25c26ba9e0ea4a70715"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free an allocated frame. Free an allocated page frame, allowing it to be allocated again.  <a href="#a84f2e5bf7896e25c26ba9e0ea4a70715">More...</a><br/></td></tr>
<tr class="separator:a84f2e5bf7896e25c26ba9e0ea4a70715"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0dec1d6d8c55ad0fafff3656c7cee62e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#a0dec1d6d8c55ad0fafff3656c7cee62e">clear_pagedir</a> (u32 *dir)</td></tr>
<tr class="memdesc:a0dec1d6d8c55ad0fafff3656c7cee62e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clear a page directory to it's default values. Clear the page directory marking every page table as non-existant.  <a href="#a0dec1d6d8c55ad0fafff3656c7cee62e">More...</a><br/></td></tr>
<tr class="separator:a0dec1d6d8c55ad0fafff3656c7cee62e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7992cc47468ac72eeb8f08f94f210d2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#ac7992cc47468ac72eeb8f08f94f210d2">fill_pagetable</a> (u32 *table, u32 <a class="el" href="paging_8c.html#a9ac6ce0ce824ca84feafe5837fc9aa9a">addr</a>)</td></tr>
<tr class="memdesc:ac7992cc47468ac72eeb8f08f94f210d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fill a page table with pages. Fill a pagetable with pages starting from <code>addr</code> and ending up at <code>addr + 0x400000</code>  <a href="#ac7992cc47468ac72eeb8f08f94f210d2">More...</a><br/></td></tr>
<tr class="separator:ac7992cc47468ac72eeb8f08f94f210d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44844a86a2d9dfe3c92936bbe16d2d0d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#a44844a86a2d9dfe3c92936bbe16d2d0d">set_pagedir</a> (u32 *dir)</td></tr>
<tr class="memdesc:a44844a86a2d9dfe3c92936bbe16d2d0d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the current page directory Sets the current page directory by setting cr3 to <code>dir</code>  <a href="#a44844a86a2d9dfe3c92936bbe16d2d0d">More...</a><br/></td></tr>
<tr class="separator:a44844a86a2d9dfe3c92936bbe16d2d0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae62af42af2d4cb211a64978ff1ef060e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#ae62af42af2d4cb211a64978ff1ef060e">enable_paging</a> ()</td></tr>
<tr class="memdesc:ae62af42af2d4cb211a64978ff1ef060e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enable paging. Enable the paging flag in cr0.  <a href="#ae62af42af2d4cb211a64978ff1ef060e">More...</a><br/></td></tr>
<tr class="separator:ae62af42af2d4cb211a64978ff1ef060e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65805eac601918e3f84e052063dac28b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#a65805eac601918e3f84e052063dac28b">disable_paging</a> ()</td></tr>
<tr class="memdesc:a65805eac601918e3f84e052063dac28b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disable paging. Sets the paging flag in cr0.  <a href="#a65805eac601918e3f84e052063dac28b">More...</a><br/></td></tr>
<tr class="separator:a65805eac601918e3f84e052063dac28b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab45e6fbcdd413040eb68d48da756d3f9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#ab45e6fbcdd413040eb68d48da756d3f9">paging_init</a> (u32 eom)</td></tr>
<tr class="memdesc:ab45e6fbcdd413040eb68d48da756d3f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize paging. Creates a new page directory, and clears it. Thes creates a new page table, and fills it with addresses starting at 0. Then it sets the page tables first page table as the newly created one. Then it sets the page directory, and enables paging.  <a href="#ab45e6fbcdd413040eb68d48da756d3f9">More...</a><br/></td></tr>
<tr class="separator:ab45e6fbcdd413040eb68d48da756d3f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa38c13c4c6a7a1ed20b6aeb079050a49"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#aa38c13c4c6a7a1ed20b6aeb079050a49">get_first_avail_hole</a> (u32 <a class="el" href="cbuff_8h.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr class="separator:aa38c13c4c6a7a1ed20b6aeb079050a49"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5bfcea7443c827f97f03d696c8ea08c0"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structalloc__head.html">alloc_head</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#a5bfcea7443c827f97f03d696c8ea08c0">__align</a> (16)</td></tr>
<tr class="separator:a5bfcea7443c827f97f03d696c8ea08c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81b30532dcebcbdcf8f9159e959fb091"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#a81b30532dcebcbdcf8f9159e959fb091">kmalloc</a> (u32 <a class="el" href="cbuff_8h.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr class="separator:a81b30532dcebcbdcf8f9159e959fb091"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a069f85a5001d71bc44d8be6532a4e432"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#a069f85a5001d71bc44d8be6532a4e432">kfree</a> (void *ptr)</td></tr>
<tr class="separator:a069f85a5001d71bc44d8be6532a4e432"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a3664686d7e92f0bca2061d088362f3d8"><td class="memItemLeft" align="right" valign="top">static u32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#a3664686d7e92f0bca2061d088362f3d8">prealloc_frames</a> [20]</td></tr>
<tr class="memdesc:a3664686d7e92f0bca2061d088362f3d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">20 frames that are free, used by alloc_frame  <a href="#a3664686d7e92f0bca2061d088362f3d8">More...</a><br/></td></tr>
<tr class="separator:a3664686d7e92f0bca2061d088362f3d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3337b35daceb6ab9c5edf3bf526e469a"><td class="memItemLeft" align="right" valign="top">static u32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#a3337b35daceb6ab9c5edf3bf526e469a">nframes</a></td></tr>
<tr class="memdesc:a3337b35daceb6ab9c5edf3bf526e469a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of frames in the table.  <a href="#a3337b35daceb6ab9c5edf3bf526e469a">More...</a><br/></td></tr>
<tr class="separator:a3337b35daceb6ab9c5edf3bf526e469a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf004ccbfa52ec6245409d7c02fba581"><td class="memItemLeft" align="right" valign="top">u32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#aaf004ccbfa52ec6245409d7c02fba581">kernel_cr3</a></td></tr>
<tr class="memdesc:aaf004ccbfa52ec6245409d7c02fba581"><td class="mdescLeft">&#160;</td><td class="mdescRight">Page directory used by the kernel.  <a href="#aaf004ccbfa52ec6245409d7c02fba581">More...</a><br/></td></tr>
<tr class="separator:aaf004ccbfa52ec6245409d7c02fba581"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:addbce032f1a6b8fed9b601bbaa43d7be"><td class="memItemLeft" align="right" valign="top">u32 *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a></td></tr>
<tr class="memdesc:addbce032f1a6b8fed9b601bbaa43d7be"><td class="mdescLeft">&#160;</td><td class="mdescRight">The location of the first page frame.  <a href="#addbce032f1a6b8fed9b601bbaa43d7be">More...</a><br/></td></tr>
<tr class="separator:addbce032f1a6b8fed9b601bbaa43d7be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3a1b5c1752b2939c1d76eed0b11d2c0"><td class="memItemLeft" align="right" valign="top">static u32 *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#ad3a1b5c1752b2939c1d76eed0b11d2c0">lastframe</a></td></tr>
<tr class="memdesc:ad3a1b5c1752b2939c1d76eed0b11d2c0"><td class="mdescLeft">&#160;</td><td class="mdescRight">The location of the last page frame.  <a href="#ad3a1b5c1752b2939c1d76eed0b11d2c0">More...</a><br/></td></tr>
<tr class="separator:ad3a1b5c1752b2939c1d76eed0b11d2c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f0d06c75bc107cce1b9d47b4100701d"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structmultiboot__module__tag.html">multiboot_module_tag</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#a0f0d06c75bc107cce1b9d47b4100701d">initrd</a></td></tr>
<tr class="separator:a0f0d06c75bc107cce1b9d47b4100701d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ac6ce0ce824ca84feafe5837fc9aa9a"><td class="memItemLeft" align="right" valign="top">u32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#a9ac6ce0ce824ca84feafe5837fc9aa9a">addr</a></td></tr>
<tr class="memdesc:a9ac6ce0ce824ca84feafe5837fc9aa9a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Address of block.  <a href="#a9ac6ce0ce824ca84feafe5837fc9aa9a">More...</a><br/></td></tr>
<tr class="separator:a9ac6ce0ce824ca84feafe5837fc9aa9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acfd6273064c5acdcfc39a23a69dd4343"><td class="memItemLeft" align="right" valign="top">u32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#acfd6273064c5acdcfc39a23a69dd4343">size</a></td></tr>
<tr class="memdesc:acfd6273064c5acdcfc39a23a69dd4343"><td class="mdescLeft">&#160;</td><td class="mdescRight">Size of block, including this header, AND padding.  <a href="#acfd6273064c5acdcfc39a23a69dd4343">More...</a><br/></td></tr>
<tr class="separator:acfd6273064c5acdcfc39a23a69dd4343"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c2f2992893a71ac0ee3f43477000176"><td class="memItemLeft" align="right" valign="top">u32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8c.html#a1c2f2992893a71ac0ee3f43477000176">magic</a></td></tr>
<tr class="memdesc:a1c2f2992893a71ac0ee3f43477000176"><td class="mdescLeft">&#160;</td><td class="mdescRight">0xA110CA1E  <a href="#a1c2f2992893a71ac0ee3f43477000176">More...</a><br/></td></tr>
<tr class="separator:a1c2f2992893a71ac0ee3f43477000176"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="acaa325523bd17bffb8ee5a2681b0a0b3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static u32 pagedir [1024] __align </td>
          <td>(</td>
          <td class="paramtype">0x1000&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Table stating which frames are available, takes up 256KiB.</p>
<p>First 4 page tables. </p>

</div>
</div>
<a class="anchor" id="a5bfcea7443c827f97f03d696c8ea08c0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structalloc__head.html">alloc_head</a> __align </td>
          <td>(</td>
          <td class="paramtype">16&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a0692bf8dce3ee5883abdba6625491437"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* alloc_frame </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocates a page frame then returns its address </p>

<p>Definition at line <a class="el" href="paging_8c_source.html#l00089">89</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>

<p>References <a class="el" href="paging_8c_source.html#l00064">get_free_frame()</a>, and <a class="el" href="paging_8c_source.html#l00013">prealloc_frames</a>.</p>
<div class="fragment"><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;{</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keyword">static</span> u32 pframe = 20;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">if</span>(pframe == 20)</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            <span class="keywordflow">for</span>(; i &lt; 20; i++)</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                <a class="code" href="paging_8c.html#a3664686d7e92f0bca2061d088362f3d8">prealloc_frames</a>[i] = (u32)<a class="code" href="paging_8c.html#a4e8b2a17d9a96f0148b6a3b249669c2c">get_free_frame</a>();</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="paging_8c.html#a3664686d7e92f0bca2061d088362f3d8">prealloc_frames</a>[i] == 0xFFFFFFFF) <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *)0xFFFFFFFF; <span class="comment">// TODO: Add some type of handling system here</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            pframe = 0;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        }</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *)<a class="code" href="paging_8c.html#a3664686d7e92f0bca2061d088362f3d8">prealloc_frames</a>[pframe++];</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;}</div>
<div class="ttc" id="paging_8c_html_a3664686d7e92f0bca2061d088362f3d8"><div class="ttname"><a href="paging_8c.html#a3664686d7e92f0bca2061d088362f3d8">prealloc_frames</a></div><div class="ttdeci">static u32 prealloc_frames[20]</div><div class="ttdoc">20 frames that are free, used by alloc_frame </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00013">paging.c:13</a></div></div>
<div class="ttc" id="paging_8c_html_a4e8b2a17d9a96f0148b6a3b249669c2c"><div class="ttname"><a href="paging_8c.html#a4e8b2a17d9a96f0148b6a3b249669c2c">get_free_frame</a></div><div class="ttdeci">static void * get_free_frame()</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00064">paging.c:64</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aef6922a09d5cc385e2f616ea32259fba"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void block_page </td>
          <td>(</td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>page</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="paging_8c_source.html#l00046">46</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>

<p>References <a class="el" href="paging_8c_source.html#l00018">firstframe</a>, and <a class="el" href="paging_8c_source.html#l00027">set_frame()</a>.</p>
<div class="fragment"><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;{</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="paging_8c.html#a65d86d5522174b72c52f3c08c848e770">set_frame</a>((page - (u32)<a class="code" href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a>) / 0x1000, 0xFFFFFFFF);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;}</div>
<div class="ttc" id="paging_8c_html_a65d86d5522174b72c52f3c08c848e770"><div class="ttname"><a href="paging_8c.html#a65d86d5522174b72c52f3c08c848e770">set_frame</a></div><div class="ttdeci">void set_frame(u32 frame, u32 val)</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00027">paging.c:27</a></div></div>
<div class="ttc" id="paging_8c_html_addbce032f1a6b8fed9b601bbaa43d7be"><div class="ttname"><a href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a></div><div class="ttdeci">u32 * firstframe</div><div class="ttdoc">The location of the first page frame. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00018">paging.c:18</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0dec1d6d8c55ad0fafff3656c7cee62e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clear_pagedir </td>
          <td>(</td>
          <td class="paramtype">u32 *&#160;</td>
          <td class="paramname"><em>dir</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="paging_8c_source.html#l00158">158</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;{</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; 1024; i++)</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        dir[i] = 2; <span class="comment">// supervisor, rw, not present.</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a65805eac601918e3f84e052063dac28b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void disable_paging </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sets the paging flag in cr0. </p>

<p>Definition at line <a class="el" href="paging_8c_source.html#l00202">202</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;{</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    u32 cr0;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;mov %%cr0, %0&quot;</span>: <span class="stringliteral">&quot;=b&quot;</span>(cr0));</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    cr0 &amp;= ~0x80000000;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;mov %0, %%cr0&quot;</span>:: <span class="stringliteral">&quot;b&quot;</span>(cr0));</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae62af42af2d4cb211a64978ff1ef060e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void enable_paging </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Enable the paging flag in cr0. </p>

<p>Definition at line <a class="el" href="paging_8c_source.html#l00191">191</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;{</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    u32 cr0;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;mov %%cr0, %0&quot;</span>: <span class="stringliteral">&quot;=b&quot;</span>(cr0));</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    cr0 |= 0x80000000;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;mov %0, %%cr0&quot;</span>:: <span class="stringliteral">&quot;b&quot;</span>(cr0));</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac7992cc47468ac72eeb8f08f94f210d2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fill_pagetable </td>
          <td>(</td>
          <td class="paramtype">u32 *&#160;</td>
          <td class="paramname"><em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">table</td><td>pointer to the page table </td></tr>
    <tr><td class="paramname">addr</td><td>address to start at </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="paging_8c_source.html#l00171">171</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;{</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    u32 i;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; 1024; i++, <a class="code" href="paging_8c.html#a9ac6ce0ce824ca84feafe5837fc9aa9a">addr</a> += 0x1000)</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        table[i] = addr | 3;  <span class="comment">// supervisor, rw, present.</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;}</div>
<div class="ttc" id="paging_8c_html_a9ac6ce0ce824ca84feafe5837fc9aa9a"><div class="ttname"><a href="paging_8c.html#a9ac6ce0ce824ca84feafe5837fc9aa9a">addr</a></div><div class="ttdeci">u32 addr</div><div class="ttdoc">Address of block. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00281">paging.c:281</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a84f2e5bf7896e25c26ba9e0ea4a70715"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_frame </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>frame</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Free an allocated page frame, allowing it to be allocated again.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">frame</td><td>frame to free </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="paging_8c_source.html#l00146">146</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>

<p>References <a class="el" href="paging_8c_source.html#l00018">firstframe</a>, and <a class="el" href="paging_8c_source.html#l00027">set_frame()</a>.</p>
<div class="fragment"><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;{</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="paging_8c.html#a65d86d5522174b72c52f3c08c848e770">set_frame</a>(((u32)frame - (u32)<a class="code" href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a>) / 0x1000, 0);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;}</div>
<div class="ttc" id="paging_8c_html_a65d86d5522174b72c52f3c08c848e770"><div class="ttname"><a href="paging_8c.html#a65d86d5522174b72c52f3c08c848e770">set_frame</a></div><div class="ttdeci">void set_frame(u32 frame, u32 val)</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00027">paging.c:27</a></div></div>
<div class="ttc" id="paging_8c_html_addbce032f1a6b8fed9b601bbaa43d7be"><div class="ttname"><a href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a></div><div class="ttdeci">u32 * firstframe</div><div class="ttdoc">The location of the first page frame. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00018">paging.c:18</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa38c13c4c6a7a1ed20b6aeb079050a49"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void* get_first_avail_hole </td>
          <td>(</td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the first available memory hole of a certain size</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td>the minimum size of the hole </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the location of the memory hole </dd></dl>

<p>Definition at line <a class="el" href="paging_8c_source.html#l00280">280</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;{</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordtype">int</span> num_4k = 0;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordtype">int</span> size4k = <a class="code" href="paging_8c.html#acfd6273064c5acdcfc39a23a69dd4343">size</a> / 0x1000;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="paging_8c.html#acfd6273064c5acdcfc39a23a69dd4343">size</a> &amp; 0x0FFF) size4k += 1;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    u32 i = 0;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    u32 base_i = 0;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">for</span>(; i &lt; <a class="code" href="paging_8c.html#a3337b35daceb6ab9c5edf3bf526e469a">nframes</a>; i++)</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="keywordflow">if</span>(!<a class="code" href="paging_8c.html#aec230565edc62c3911800334ba8357bb">test_frame</a>(i))</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <span class="keywordflow">if</span>(base_i == 0xFFFFFFFF) base_i = i;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            num_4k++;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            <span class="keywordflow">if</span>(num_4k &gt;= size4k)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                u32 q = base_i;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                <span class="keywordflow">for</span>(; q &lt;= i; q++)</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                {</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                    <a class="code" href="paging_8c.html#a65d86d5522174b72c52f3c08c848e770">set_frame</a>(q, 1);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                    <span class="comment">// BUG: This crashes while using kmalloc at some points...</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                    <span class="comment">//</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                    <span class="comment">//</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                    <span class="comment">//</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                    <span class="comment">//map_page((void *)((q * 0x1000) + (u32)firstframe), (void *)((q * 0x1000) + (u32)firstframe), 3);</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                }</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *)((base_i * 0x1000) + <a class="code" href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a>);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <span class="keywordflow">else</span> base_i = 0xFFFFFFFF;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <a class="code" href="error_8h.html#a2e9b2c29084c4a3193a6c1c1f39e36f8">kerror</a>(<a class="code" href="error_8h.html#adfccb88929c124c0313e7a14243a0389abbe95803f49255df4326d9cc1c8afbf4">ERR_SMERR</a>, <span class="stringliteral">&quot;Could not find %d KiB block&quot;</span>, size4k * 4);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;}</div>
<div class="ttc" id="paging_8c_html_acfd6273064c5acdcfc39a23a69dd4343"><div class="ttname"><a href="paging_8c.html#acfd6273064c5acdcfc39a23a69dd4343">size</a></div><div class="ttdeci">u32 size</div><div class="ttdoc">Size of block, including this header, AND padding. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00282">paging.c:282</a></div></div>
<div class="ttc" id="error_8h_html_a2e9b2c29084c4a3193a6c1c1f39e36f8"><div class="ttname"><a href="error_8h.html#a2e9b2c29084c4a3193a6c1c1f39e36f8">kerror</a></div><div class="ttdeci">void kerror(error_level errlvl, char *msg,...)</div><div class="ttdoc">Prints information about the kernel. Disables interrupts so it will not get interrupted, checks to see if the error level is &gt;= the minimum level, and if so, prints the current clock tick, then prints the error message. Then, if en_int != 0, it enables interrupts again. </div><div class="ttdef"><b>Definition:</b> <a href="error_8c_source.html#l00022">error.c:22</a></div></div>
<div class="ttc" id="paging_8c_html_a65d86d5522174b72c52f3c08c848e770"><div class="ttname"><a href="paging_8c.html#a65d86d5522174b72c52f3c08c848e770">set_frame</a></div><div class="ttdeci">void set_frame(u32 frame, u32 val)</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00027">paging.c:27</a></div></div>
<div class="ttc" id="paging_8c_html_aec230565edc62c3911800334ba8357bb"><div class="ttname"><a href="paging_8c.html#aec230565edc62c3911800334ba8357bb">test_frame</a></div><div class="ttdeci">static u32 test_frame(u32 frame)</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00056">paging.c:56</a></div></div>
<div class="ttc" id="paging_8c_html_a3337b35daceb6ab9c5edf3bf526e469a"><div class="ttname"><a href="paging_8c.html#a3337b35daceb6ab9c5edf3bf526e469a">nframes</a></div><div class="ttdeci">static u32 nframes</div><div class="ttdoc">Number of frames in the table. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00014">paging.c:14</a></div></div>
<div class="ttc" id="error_8h_html_adfccb88929c124c0313e7a14243a0389abbe95803f49255df4326d9cc1c8afbf4"><div class="ttname"><a href="error_8h.html#adfccb88929c124c0313e7a14243a0389abbe95803f49255df4326d9cc1c8afbf4">ERR_SMERR</a></div><div class="ttdoc">A small, easily ignored error. </div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00009">error.h:9</a></div></div>
<div class="ttc" id="paging_8c_html_addbce032f1a6b8fed9b601bbaa43d7be"><div class="ttname"><a href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a></div><div class="ttdeci">u32 * firstframe</div><div class="ttdoc">The location of the first page frame. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00018">paging.c:18</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4e8b2a17d9a96f0148b6a3b249669c2c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void* get_free_frame </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Look through the pages, and see if any are available. </p>

<p>Definition at line <a class="el" href="paging_8c_source.html#l00064">64</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>

<p>References <a class="el" href="paging_8c_source.html#l00018">firstframe</a>, <a class="el" href="paging_8c_source.html#l00113">map_page()</a>, <a class="el" href="paging_8c_source.html#l00014">nframes</a>, <a class="el" href="paging_8c_source.html#l00027">set_frame()</a>, and <a class="el" href="paging_8c_source.html#l00056">test_frame()</a>.</p>
<div class="fragment"><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;{</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        u32 i = 0;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="keywordflow">while</span>(<a class="code" href="paging_8c.html#aec230565edc62c3911800334ba8357bb">test_frame</a>(i) != 0)</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            <span class="keywordflow">if</span>(frames[i/32] == 0xFFFFFFFF)</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                i += 32;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            }</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <span class="keywordflow">if</span>(i == <a class="code" href="paging_8c.html#a3337b35daceb6ab9c5edf3bf526e469a">nframes</a>)</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *)0xFFFFFFFF; <span class="comment">// Error, no pages available</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            i++;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <a class="code" href="paging_8c.html#a65d86d5522174b72c52f3c08c848e770">set_frame</a>(i, 1);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <a class="code" href="paging_8c.html#ae46f6fc37cc817eba111627d8966d49d">map_page</a>(<a class="code" href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a> + (i*0x1000), <a class="code" href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a> + (i*0x1000), 3); <span class="comment">// Make sure it is mapped</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keywordflow">return</span> (<a class="code" href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a> + (i*0x1000));</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div>
<div class="ttc" id="paging_8c_html_ae46f6fc37cc817eba111627d8966d49d"><div class="ttname"><a href="paging_8c.html#ae46f6fc37cc817eba111627d8966d49d">map_page</a></div><div class="ttdeci">void map_page(void *physaddr, void *virtualaddr, u32 flags)</div><div class="ttdoc">Map a virtual address to a physical one. Map a virtual address to a physical one. ...</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00113">paging.c:113</a></div></div>
<div class="ttc" id="paging_8c_html_a65d86d5522174b72c52f3c08c848e770"><div class="ttname"><a href="paging_8c.html#a65d86d5522174b72c52f3c08c848e770">set_frame</a></div><div class="ttdeci">void set_frame(u32 frame, u32 val)</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00027">paging.c:27</a></div></div>
<div class="ttc" id="paging_8c_html_aec230565edc62c3911800334ba8357bb"><div class="ttname"><a href="paging_8c.html#aec230565edc62c3911800334ba8357bb">test_frame</a></div><div class="ttdeci">static u32 test_frame(u32 frame)</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00056">paging.c:56</a></div></div>
<div class="ttc" id="paging_8c_html_a3337b35daceb6ab9c5edf3bf526e469a"><div class="ttname"><a href="paging_8c.html#a3337b35daceb6ab9c5edf3bf526e469a">nframes</a></div><div class="ttdeci">static u32 nframes</div><div class="ttdoc">Number of frames in the table. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00014">paging.c:14</a></div></div>
<div class="ttc" id="paging_8c_html_addbce032f1a6b8fed9b601bbaa43d7be"><div class="ttname"><a href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a></div><div class="ttdeci">u32 * firstframe</div><div class="ttdoc">The location of the first page frame. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00018">paging.c:18</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a069f85a5001d71bc44d8be6532a4e432"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kfree </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Free a region of memory that was allocated by malloc earlier.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ptr</td><td>pointer to memory region </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd>malloc </dd></dl>

<p>Definition at line <a class="el" href="paging_8c_source.html#l00360">360</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>

<p>References <a class="el" href="paging_8c_source.html#l00318">alloc_head::addr</a>, <a class="el" href="error_8h_source.html#l00009">ERR_SMERR</a>, <a class="el" href="paging_8c_source.html#l00018">firstframe</a>, <a class="el" href="error_8c_source.html#l00022">kerror()</a>, <a class="el" href="paging_8c_source.html#l00320">alloc_head::magic</a>, <a class="el" href="paging_8c_source.html#l00027">set_frame()</a>, and <a class="el" href="paging_8c_source.html#l00319">alloc_head::size</a>.</p>
<div class="fragment"><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;{</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keywordflow">if</span>(!ptr)</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    {</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <a class="code" href="error_8h.html#a2e9b2c29084c4a3193a6c1c1f39e36f8">kerror</a>(<a class="code" href="error_8h.html#adfccb88929c124c0313e7a14243a0389abbe95803f49255df4326d9cc1c8afbf4">ERR_SMERR</a>, <span class="stringliteral">&quot;Pointer given to `kfree` is null&quot;</span>);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keyword">struct </span><a class="code" href="structalloc__head.html">alloc_head</a> *header = (<span class="keyword">struct </span><a class="code" href="structalloc__head.html">alloc_head</a> *)(ptr - <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structalloc__head.html">alloc_head</a>));</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordflow">if</span>((header-&gt;<a class="code" href="structalloc__head.html#a2c5e56e1560de1651c71e9f978bc30ad">magic</a> != 0xA110CA1E) || (header-&gt;<a class="code" href="structalloc__head.html#a7c5d3f93b656edadb52f8936ce0c4558">addr</a> != (u32)ptr))</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    {</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <a class="code" href="error_8h.html#a2e9b2c29084c4a3193a6c1c1f39e36f8">kerror</a>(<a class="code" href="error_8h.html#adfccb88929c124c0313e7a14243a0389abbe95803f49255df4326d9cc1c8afbf4">ERR_SMERR</a>, <span class="stringliteral">&quot;Pointer given to `kfree` is invalid&quot;</span>);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    u32 i = 0;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">for</span>(; i &lt; header-&gt;<a class="code" href="structalloc__head.html#ad7464c34b524d99c625ec83f3c88d790">size</a> / 0x1000; i++)</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <a class="code" href="paging_8c.html#a65d86d5522174b72c52f3c08c848e770">set_frame</a>(i + (((u32)header - (u32)<a class="code" href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a>) / 0x1000), 0);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="comment">// Invalidate header</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    header-&gt;<a class="code" href="structalloc__head.html#a2c5e56e1560de1651c71e9f978bc30ad">magic</a> = 0;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    header-&gt;<a class="code" href="structalloc__head.html#a7c5d3f93b656edadb52f8936ce0c4558">addr</a>  = 0;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    header-&gt;<a class="code" href="structalloc__head.html#ad7464c34b524d99c625ec83f3c88d790">size</a>  = 0;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;}<div class="ttc" id="structalloc__head_html_a2c5e56e1560de1651c71e9f978bc30ad"><div class="ttname"><a href="structalloc__head.html#a2c5e56e1560de1651c71e9f978bc30ad">alloc_head::magic</a></div><div class="ttdeci">u32 magic</div><div class="ttdoc">0xA110CA1E </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00320">paging.c:320</a></div></div>
<div class="ttc" id="error_8h_html_a2e9b2c29084c4a3193a6c1c1f39e36f8"><div class="ttname"><a href="error_8h.html#a2e9b2c29084c4a3193a6c1c1f39e36f8">kerror</a></div><div class="ttdeci">void kerror(error_level errlvl, char *msg,...)</div><div class="ttdoc">Prints information about the kernel. Disables interrupts so it will not get interrupted, checks to see if the error level is &gt;= the minimum level, and if so, prints the current clock tick, then prints the error message. Then, if en_int != 0, it enables interrupts again. </div><div class="ttdef"><b>Definition:</b> <a href="error_8c_source.html#l00022">error.c:22</a></div></div>
<div class="ttc" id="structalloc__head_html_ad7464c34b524d99c625ec83f3c88d790"><div class="ttname"><a href="structalloc__head.html#ad7464c34b524d99c625ec83f3c88d790">alloc_head::size</a></div><div class="ttdeci">u32 size</div><div class="ttdoc">Size of block, including this header, AND padding. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00319">paging.c:319</a></div></div>
<div class="ttc" id="structalloc__head_html_a7c5d3f93b656edadb52f8936ce0c4558"><div class="ttname"><a href="structalloc__head.html#a7c5d3f93b656edadb52f8936ce0c4558">alloc_head::addr</a></div><div class="ttdeci">u32 addr</div><div class="ttdoc">Address of block. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00318">paging.c:318</a></div></div>
<div class="ttc" id="paging_8c_html_a65d86d5522174b72c52f3c08c848e770"><div class="ttname"><a href="paging_8c.html#a65d86d5522174b72c52f3c08c848e770">set_frame</a></div><div class="ttdeci">void set_frame(u32 frame, u32 val)</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00027">paging.c:27</a></div></div>
<div class="ttc" id="error_8h_html_adfccb88929c124c0313e7a14243a0389abbe95803f49255df4326d9cc1c8afbf4"><div class="ttname"><a href="error_8h.html#adfccb88929c124c0313e7a14243a0389abbe95803f49255df4326d9cc1c8afbf4">ERR_SMERR</a></div><div class="ttdoc">A small, easily ignored error. </div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00009">error.h:9</a></div></div>
<div class="ttc" id="paging_8c_html_addbce032f1a6b8fed9b601bbaa43d7be"><div class="ttname"><a href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a></div><div class="ttdeci">u32 * firstframe</div><div class="ttdoc">The location of the first page frame. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00018">paging.c:18</a></div></div>
<div class="ttc" id="structalloc__head_html"><div class="ttname"><a href="structalloc__head.html">alloc_head</a></div><div class="ttdoc">&lt; Header for allocated blocks </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00316">paging.c:316</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a81b30532dcebcbdcf8f9159e959fb091"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* kmalloc </td>
          <td>(</td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate a region of memory to be used later.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td>size of the memory region </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>address of the memory region </dd></dl>

<p>Definition at line <a class="el" href="paging_8c_source.html#l00329">329</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>

<p>References <a class="el" href="paging_8c_source.html#l00318">alloc_head::addr</a>, <a class="el" href="int_8h_source.html#l00011">disable_interrupts()</a>, <a class="el" href="int_8h_source.html#l00006">enable_interrupts()</a>, <a class="el" href="paging_8c_source.html#l00280">get_first_avail_hole()</a>, <a class="el" href="int_8h.html#ac25439f2967903295b4fc450a6f7eb84">interrupts_enabled()</a>, <a class="el" href="paging_8c_source.html#l00320">alloc_head::magic</a>, <a class="el" href="types_8h_source.html#l00066">NULL</a>, <a class="el" href="paging_8c_source.html#l00282">size</a>, and <a class="el" href="paging_8c_source.html#l00319">alloc_head::size</a>.</p>
<div class="fragment"><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;{</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordtype">int</span> ints_en = <a class="code" href="int_8h.html#ac25439f2967903295b4fc450a6f7eb84">interrupts_enabled</a>();</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <a class="code" href="int_8h.html#a581446e0a9841a0535fd2a35ae9b67f2">disable_interrupts</a>();</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <a class="code" href="paging_8c.html#acfd6273064c5acdcfc39a23a69dd4343">size</a> += <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structalloc__head.html">alloc_head</a>);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    u32 rsize = ((<a class="code" href="paging_8c.html#acfd6273064c5acdcfc39a23a69dd4343">size</a> &amp; 0x0FFF) ? (<a class="code" href="paging_8c.html#acfd6273064c5acdcfc39a23a69dd4343">size</a> + 0x1000) : (<a class="code" href="paging_8c.html#acfd6273064c5acdcfc39a23a69dd4343">size</a>)) &amp; 0xFFFFF000;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordtype">void</span> *base = <a class="code" href="paging_8c.html#aa38c13c4c6a7a1ed20b6aeb079050a49">get_first_avail_hole</a>(rsize);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">if</span>(!base)</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    {</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="comment">// Error already reported, just return</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keyword">struct </span><a class="code" href="structalloc__head.html">alloc_head</a> *header = (<span class="keyword">struct </span><a class="code" href="structalloc__head.html">alloc_head</a> *)base;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    header-&gt;<a class="code" href="structalloc__head.html#a7c5d3f93b656edadb52f8936ce0c4558">addr</a>  = (u32)base + <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structalloc__head.html">alloc_head</a>);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    header-&gt;<a class="code" href="structalloc__head.html#ad7464c34b524d99c625ec83f3c88d790">size</a>  = rsize;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    header-&gt;<a class="code" href="structalloc__head.html#a2c5e56e1560de1651c71e9f978bc30ad">magic</a> = 0xA110CA1E;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">if</span>(ints_en) <a class="code" href="int_8h.html#a04895df25c408c90d3f11fe3149c51b2">enable_interrupts</a>();</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *)header-&gt;<a class="code" href="structalloc__head.html#a7c5d3f93b656edadb52f8936ce0c4558">addr</a>;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;}</div>
<div class="ttc" id="paging_8c_html_aa38c13c4c6a7a1ed20b6aeb079050a49"><div class="ttname"><a href="paging_8c.html#aa38c13c4c6a7a1ed20b6aeb079050a49">get_first_avail_hole</a></div><div class="ttdeci">static void * get_first_avail_hole(u32 size)</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00280">paging.c:280</a></div></div>
<div class="ttc" id="structalloc__head_html_a2c5e56e1560de1651c71e9f978bc30ad"><div class="ttname"><a href="structalloc__head.html#a2c5e56e1560de1651c71e9f978bc30ad">alloc_head::magic</a></div><div class="ttdeci">u32 magic</div><div class="ttdoc">0xA110CA1E </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00320">paging.c:320</a></div></div>
<div class="ttc" id="paging_8c_html_acfd6273064c5acdcfc39a23a69dd4343"><div class="ttname"><a href="paging_8c.html#acfd6273064c5acdcfc39a23a69dd4343">size</a></div><div class="ttdeci">u32 size</div><div class="ttdoc">Size of block, including this header, AND padding. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00282">paging.c:282</a></div></div>
<div class="ttc" id="int_8h_html_a04895df25c408c90d3f11fe3149c51b2"><div class="ttname"><a href="int_8h.html#a04895df25c408c90d3f11fe3149c51b2">enable_interrupts</a></div><div class="ttdeci">static void enable_interrupts()</div><div class="ttdef"><b>Definition:</b> <a href="int_8h_source.html#l00006">int.h:6</a></div></div>
<div class="ttc" id="int_8h_html_a581446e0a9841a0535fd2a35ae9b67f2"><div class="ttname"><a href="int_8h.html#a581446e0a9841a0535fd2a35ae9b67f2">disable_interrupts</a></div><div class="ttdeci">static void disable_interrupts()</div><div class="ttdef"><b>Definition:</b> <a href="int_8h_source.html#l00011">int.h:11</a></div></div>
<div class="ttc" id="structalloc__head_html_ad7464c34b524d99c625ec83f3c88d790"><div class="ttname"><a href="structalloc__head.html#ad7464c34b524d99c625ec83f3c88d790">alloc_head::size</a></div><div class="ttdeci">u32 size</div><div class="ttdoc">Size of block, including this header, AND padding. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00319">paging.c:319</a></div></div>
<div class="ttc" id="structalloc__head_html_a7c5d3f93b656edadb52f8936ce0c4558"><div class="ttname"><a href="structalloc__head.html#a7c5d3f93b656edadb52f8936ce0c4558">alloc_head::addr</a></div><div class="ttdeci">u32 addr</div><div class="ttdoc">Address of block. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00318">paging.c:318</a></div></div>
<div class="ttc" id="types_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00066">types.h:66</a></div></div>
<div class="ttc" id="int_8h_html_ac25439f2967903295b4fc450a6f7eb84"><div class="ttname"><a href="int_8h.html#ac25439f2967903295b4fc450a6f7eb84">interrupts_enabled</a></div><div class="ttdeci">int interrupts_enabled()</div><div class="ttdoc">in intr.asm </div></div>
<div class="ttc" id="structalloc__head_html"><div class="ttname"><a href="structalloc__head.html">alloc_head</a></div><div class="ttdoc">&lt; Header for allocated blocks </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00316">paging.c:316</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae46f6fc37cc817eba111627d8966d49d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void map_page </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>physaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>virtualaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Map a virtual address to a physical one.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">physaddr</td><td>physical address to be mapped to </td></tr>
    <tr><td class="paramname">virtualaddr</td><td>virtual address to map </td></tr>
    <tr><td class="paramname">flags</td><td>information about the page mapping </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="paging_8c_source.html#l00113">113</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>

<p>References <a class="el" href="paging_8c_source.html#l00089">alloc_frame()</a>, <a class="el" href="paging_8c_source.html#l00018">firstframe</a>, <a class="el" href="paging_8c_source.html#l00019">lastframe</a>, and <a class="el" href="paging_8c_source.html#l00027">set_frame()</a>.</p>
<div class="fragment"><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;{</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    virtualaddr = (<span class="keywordtype">void</span> *)((u32)virtualaddr &amp; 0xFFFFF000);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    physaddr    = (<span class="keywordtype">void</span> *)((u32)physaddr    &amp; 0xFFFFF000);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    u32 pdindex = (u32)virtualaddr &gt;&gt; 22;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    u32 ptindex = (u32)virtualaddr &gt;&gt; 12 &amp; 0x03FF;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="comment">// Should I check if it is already present? I don&#39;t know...</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordflow">if</span>(pagedir[pdindex] &amp; 0x01)</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        ((u32 *)pagedir[pdindex])[ptindex] = ((u32)physaddr) | (flags &amp; 0xFFF) | 0x01;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        pagedir[pdindex] = (u32)<a class="code" href="paging_8c.html#a0692bf8dce3ee5883abdba6625491437">alloc_frame</a>() | 0x03;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">for</span>(; i &lt; 1024; i++)</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            ((u32 *)pagedir[pdindex])[i] = 0x00000000;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        ((u32 *)pagedir[pdindex])[ptindex] = ((u32)physaddr) | (flags &amp; 0xFFF) | 0x01;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    }</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">// These pages must NOT be reused</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">if</span>((((u32)virtualaddr / 0x1000) &gt; (u32)<a class="code" href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a>) &amp;&amp; (((u32)virtualaddr / 0x1000) &lt; (u32)<a class="code" href="paging_8c.html#ad3a1b5c1752b2939c1d76eed0b11d2c0">lastframe</a>)) <a class="code" href="paging_8c.html#a65d86d5522174b72c52f3c08c848e770">set_frame</a>(((((u32)virtualaddr) - (u32)<a class="code" href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a>) / 0x1000), 1);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">if</span>((((u32)physaddr / 0x1000)    &gt; (u32)<a class="code" href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a>) &amp;&amp; (((u32)physaddr    / 0x1000) &lt; (u32)<a class="code" href="paging_8c.html#ad3a1b5c1752b2939c1d76eed0b11d2c0">lastframe</a>)) <a class="code" href="paging_8c.html#a65d86d5522174b72c52f3c08c848e770">set_frame</a>(((((u32)physaddr)    - (u32)firstframe) / 0x1000), 1);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;}</div>
<div class="ttc" id="paging_8c_html_ad3a1b5c1752b2939c1d76eed0b11d2c0"><div class="ttname"><a href="paging_8c.html#ad3a1b5c1752b2939c1d76eed0b11d2c0">lastframe</a></div><div class="ttdeci">static u32 * lastframe</div><div class="ttdoc">The location of the last page frame. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00019">paging.c:19</a></div></div>
<div class="ttc" id="paging_8c_html_a65d86d5522174b72c52f3c08c848e770"><div class="ttname"><a href="paging_8c.html#a65d86d5522174b72c52f3c08c848e770">set_frame</a></div><div class="ttdeci">void set_frame(u32 frame, u32 val)</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00027">paging.c:27</a></div></div>
<div class="ttc" id="paging_8c_html_a0692bf8dce3ee5883abdba6625491437"><div class="ttname"><a href="paging_8c.html#a0692bf8dce3ee5883abdba6625491437">alloc_frame</a></div><div class="ttdeci">void * alloc_frame()</div><div class="ttdoc">Allocate a frame. Allocates a page frame then returns its address. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00089">paging.c:89</a></div></div>
<div class="ttc" id="paging_8c_html_addbce032f1a6b8fed9b601bbaa43d7be"><div class="ttname"><a href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a></div><div class="ttdeci">u32 * firstframe</div><div class="ttdoc">The location of the first page frame. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00018">paging.c:18</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab45e6fbcdd413040eb68d48da756d3f9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void paging_init </td>
          <td>(</td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>eom</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Creates a new page directory, and clears it. Thes creates a new page table, and fills it with addresses starting at 0. Then it sets the page tables first page table as the newly created one. Then it sets the page directory, and enables paging.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">eom</td><td>end of memory </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="paging_8c.html#a0dec1d6d8c55ad0fafff3656c7cee62e" title="Clear a page directory to it&#39;s default values. Clear the page directory marking every page table as n...">clear_pagedir</a> </dd>
<dd>
<a class="el" href="paging_8c.html#ac7992cc47468ac72eeb8f08f94f210d2" title="Fill a page table with pages. Fill a pagetable with pages starting from addr and ending up at addr + ...">fill_pagetable</a> </dd>
<dd>
<a class="el" href="paging_8c.html#ae62af42af2d4cb211a64978ff1ef060e" title="Enable paging. Enable the paging flag in cr0. ">enable_paging</a> </dd></dl>

<p>Definition at line <a class="el" href="paging_8c_source.html#l00222">222</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>

<p>References <a class="el" href="paging_8c_source.html#l00158">clear_pagedir()</a>, <a class="el" href="paging_8c_source.html#l00191">enable_paging()</a>, <a class="el" href="paging_8c_source.html#l00171">fill_pagetable()</a>, <a class="el" href="paging_8c_source.html#l00018">firstframe</a>, <a class="el" href="mem_8h_source.html#l00006">FRAMES_START</a>, <a class="el" href="paging_8c_source.html#l00016">kernel_cr3</a>, <a class="el" href="paging_8c_source.html#l00019">lastframe</a>, <a class="el" href="paging_8c_source.html#l00014">nframes</a>, and <a class="el" href="paging_8c_source.html#l00183">set_pagedir()</a>.</p>
<div class="fragment"><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;{</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <a class="code" href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a> = (u32 *)<a class="code" href="mem_8h.html#a61ac234688a12bf083ac1abb075c4938">FRAMES_START</a>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <a class="code" href="paging_8c.html#ad3a1b5c1752b2939c1d76eed0b11d2c0">lastframe</a>  = (u32 *)(eom &amp; 0xFFFFF000);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <a class="code" href="paging_8c.html#a3337b35daceb6ab9c5edf3bf526e469a">nframes</a> = (u32)(eom - (u32)<a class="code" href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a>) / 0x1000;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    u32 i = 0;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">for</span>(; i &lt; <a class="code" href="paging_8c.html#a3337b35daceb6ab9c5edf3bf526e469a">nframes</a>; i += 32, frames[i] = 0);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <a class="code" href="paging_8c.html#a0dec1d6d8c55ad0fafff3656c7cee62e">clear_pagedir</a>(pagedir);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="paging_8c.html#ac7992cc47468ac72eeb8f08f94f210d2">fill_pagetable</a>((<span class="keywordtype">void</span> *)init_tbls[0], 0x00000000);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <a class="code" href="paging_8c.html#ac7992cc47468ac72eeb8f08f94f210d2">fill_pagetable</a>((<span class="keywordtype">void</span> *)init_tbls[1], 0x00400000);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <a class="code" href="paging_8c.html#ac7992cc47468ac72eeb8f08f94f210d2">fill_pagetable</a>((<span class="keywordtype">void</span> *)init_tbls[2], 0x00800000);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <a class="code" href="paging_8c.html#ac7992cc47468ac72eeb8f08f94f210d2">fill_pagetable</a>((<span class="keywordtype">void</span> *)init_tbls[3], 0x00C00000);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    pagedir[0] = (u32)init_tbls[0] | 3;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    pagedir[1] = (u32)init_tbls[1] | 3;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    pagedir[2] = (u32)init_tbls[2] | 3;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    pagedir[3] = (u32)init_tbls[3] | 3;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <a class="code" href="paging_8c.html#aaf004ccbfa52ec6245409d7c02fba581">kernel_cr3</a> = (u32)pagedir;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <a class="code" href="paging_8c.html#a44844a86a2d9dfe3c92936bbe16d2d0d">set_pagedir</a>(pagedir);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="paging_8c.html#ae62af42af2d4cb211a64978ff1ef060e">enable_paging</a>();</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;}</div>
<div class="ttc" id="paging_8c_html_ad3a1b5c1752b2939c1d76eed0b11d2c0"><div class="ttname"><a href="paging_8c.html#ad3a1b5c1752b2939c1d76eed0b11d2c0">lastframe</a></div><div class="ttdeci">static u32 * lastframe</div><div class="ttdoc">The location of the last page frame. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00019">paging.c:19</a></div></div>
<div class="ttc" id="paging_8c_html_a0dec1d6d8c55ad0fafff3656c7cee62e"><div class="ttname"><a href="paging_8c.html#a0dec1d6d8c55ad0fafff3656c7cee62e">clear_pagedir</a></div><div class="ttdeci">void clear_pagedir(u32 *dir)</div><div class="ttdoc">Clear a page directory to it&#39;s default values. Clear the page directory marking every page table as n...</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00158">paging.c:158</a></div></div>
<div class="ttc" id="paging_8c_html_aaf004ccbfa52ec6245409d7c02fba581"><div class="ttname"><a href="paging_8c.html#aaf004ccbfa52ec6245409d7c02fba581">kernel_cr3</a></div><div class="ttdeci">u32 kernel_cr3</div><div class="ttdoc">Page directory used by the kernel. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00016">paging.c:16</a></div></div>
<div class="ttc" id="paging_8c_html_a44844a86a2d9dfe3c92936bbe16d2d0d"><div class="ttname"><a href="paging_8c.html#a44844a86a2d9dfe3c92936bbe16d2d0d">set_pagedir</a></div><div class="ttdeci">void set_pagedir(u32 *dir)</div><div class="ttdoc">Set the current page directory Sets the current page directory by setting cr3 to dir ...</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00183">paging.c:183</a></div></div>
<div class="ttc" id="paging_8c_html_ae62af42af2d4cb211a64978ff1ef060e"><div class="ttname"><a href="paging_8c.html#ae62af42af2d4cb211a64978ff1ef060e">enable_paging</a></div><div class="ttdeci">void enable_paging()</div><div class="ttdoc">Enable paging. Enable the paging flag in cr0. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00191">paging.c:191</a></div></div>
<div class="ttc" id="paging_8c_html_a3337b35daceb6ab9c5edf3bf526e469a"><div class="ttname"><a href="paging_8c.html#a3337b35daceb6ab9c5edf3bf526e469a">nframes</a></div><div class="ttdeci">static u32 nframes</div><div class="ttdoc">Number of frames in the table. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00014">paging.c:14</a></div></div>
<div class="ttc" id="paging_8c_html_addbce032f1a6b8fed9b601bbaa43d7be"><div class="ttname"><a href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a></div><div class="ttdeci">u32 * firstframe</div><div class="ttdoc">The location of the first page frame. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00018">paging.c:18</a></div></div>
<div class="ttc" id="mem_8h_html_a61ac234688a12bf083ac1abb075c4938"><div class="ttname"><a href="mem_8h.html#a61ac234688a12bf083ac1abb075c4938">FRAMES_START</a></div><div class="ttdeci">#define FRAMES_START</div><div class="ttdoc">Start of page frames. </div><div class="ttdef"><b>Definition:</b> <a href="mem_8h_source.html#l00006">mem.h:6</a></div></div>
<div class="ttc" id="paging_8c_html_ac7992cc47468ac72eeb8f08f94f210d2"><div class="ttname"><a href="paging_8c.html#ac7992cc47468ac72eeb8f08f94f210d2">fill_pagetable</a></div><div class="ttdeci">void fill_pagetable(u32 *table, u32 addr)</div><div class="ttdoc">Fill a page table with pages. Fill a pagetable with pages starting from addr and ending up at addr + ...</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00171">paging.c:171</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a65d86d5522174b72c52f3c08c848e770"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_frame </td>
          <td>(</td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>frame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sets the current frame to be used or unused, depending on <code>val</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">frame</td><td>the frame to be set </td></tr>
    <tr><td class="paramname">val</td><td>wether the frame is used or unused </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="paging_8c_source.html#l00027">27</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>

<p>References <a class="el" href="paging_8c_source.html#l00281">addr</a>, <a class="el" href="error_8h_source.html#l00010">ERR_MEDERR</a>, <a class="el" href="paging_8c_source.html#l00018">firstframe</a>, and <a class="el" href="error_8c_source.html#l00022">kerror()</a>.</p>
<div class="fragment"><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;{</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="comment">//kerror(ERR_BOOTINFO, &quot;  set_frame(%08X, %08X)&quot;, frame, val);</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keywordflow">if</span>(val == 1)</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    {</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        frames[frame / 32] |=  (1 &lt;&lt; (frame % 32));</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    }</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(val == 0) frames[frame / 32] &amp;= ~(1 &lt;&lt; (frame % 32));</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(val == 0xFFFFFFFF) <span class="comment">// BLOCK this page from use</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    {</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        frames[frame / 32] |= (1 &lt;&lt; (frame % 32));</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        u32 <a class="code" href="paging_8c.html#a9ac6ce0ce824ca84feafe5837fc9aa9a">addr</a> = (((frame * 0x1000) + (u32)<a class="code" href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a>) &amp; 0xFFFFF000);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        u32 pdindex = addr &gt;&gt; 22;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        u32 ptindex = addr &gt;&gt; 12 &amp; 0x03FF;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        ((u32 *)pagedir[pdindex])[ptindex] = 0x00000000; <span class="comment">// Invalidate the page</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    }</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordflow">else</span> <a class="code" href="error_8h.html#a2e9b2c29084c4a3193a6c1c1f39e36f8">kerror</a>(<a class="code" href="error_8h.html#adfccb88929c124c0313e7a14243a0389ac58e9a937f93b7844c2bf35fc77c10c5">ERR_MEDERR</a>, <span class="stringliteral">&quot;invalid value to set_frame: %d&quot;</span>, val);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;}</div>
<div class="ttc" id="error_8h_html_a2e9b2c29084c4a3193a6c1c1f39e36f8"><div class="ttname"><a href="error_8h.html#a2e9b2c29084c4a3193a6c1c1f39e36f8">kerror</a></div><div class="ttdeci">void kerror(error_level errlvl, char *msg,...)</div><div class="ttdoc">Prints information about the kernel. Disables interrupts so it will not get interrupted, checks to see if the error level is &gt;= the minimum level, and if so, prints the current clock tick, then prints the error message. Then, if en_int != 0, it enables interrupts again. </div><div class="ttdef"><b>Definition:</b> <a href="error_8c_source.html#l00022">error.c:22</a></div></div>
<div class="ttc" id="error_8h_html_adfccb88929c124c0313e7a14243a0389ac58e9a937f93b7844c2bf35fc77c10c5"><div class="ttname"><a href="error_8h.html#adfccb88929c124c0313e7a14243a0389ac58e9a937f93b7844c2bf35fc77c10c5">ERR_MEDERR</a></div><div class="ttdoc">A slightly worse error, but can USUALLY be ignored. </div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00010">error.h:10</a></div></div>
<div class="ttc" id="paging_8c_html_a9ac6ce0ce824ca84feafe5837fc9aa9a"><div class="ttname"><a href="paging_8c.html#a9ac6ce0ce824ca84feafe5837fc9aa9a">addr</a></div><div class="ttdeci">u32 addr</div><div class="ttdoc">Address of block. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00281">paging.c:281</a></div></div>
<div class="ttc" id="paging_8c_html_addbce032f1a6b8fed9b601bbaa43d7be"><div class="ttname"><a href="paging_8c.html#addbce032f1a6b8fed9b601bbaa43d7be">firstframe</a></div><div class="ttdeci">u32 * firstframe</div><div class="ttdoc">The location of the first page frame. </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00018">paging.c:18</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a44844a86a2d9dfe3c92936bbe16d2d0d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_pagedir </td>
          <td>(</td>
          <td class="paramtype">u32 *&#160;</td>
          <td class="paramname"><em>dir</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sets the current page directory by setting cr3 to <code>dir</code></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dir</td><td>the page directory </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="paging_8c_source.html#l00183">183</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;{</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;mov %0, %%cr3&quot;</span>:: <span class="stringliteral">&quot;b&quot;</span>(dir));</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aec230565edc62c3911800334ba8357bb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static u32 test_frame </td>
          <td>(</td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>frame</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Checks if the frame is not being used.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">frame</td><td>the frame to be tested </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="paging_8c_source.html#l00056">56</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;{</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordflow">return</span> ((frames[frame / 32] &amp; (1 &lt;&lt; (frame % 32))) != 0);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a9ac6ce0ce824ca84feafe5837fc9aa9a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u32 addr</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="paging_8c_source.html#l00281">281</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>

</div>
</div>
<a class="anchor" id="addbce032f1a6b8fed9b601bbaa43d7be"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u32* firstframe</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="paging_8c_source.html#l00018">18</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0f0d06c75bc107cce1b9d47b4100701d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structmultiboot__module__tag.html">multiboot_module_tag</a>* initrd</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="initrd_8c_source.html#l00010">10</a> of file <a class="el" href="initrd_8c_source.html">initrd.c</a>.</p>

</div>
</div>
<a class="anchor" id="aaf004ccbfa52ec6245409d7c02fba581"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u32 kernel_cr3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="paging_8c_source.html#l00016">16</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad3a1b5c1752b2939c1d76eed0b11d2c0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">u32* lastframe</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="paging_8c_source.html#l00019">19</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1c2f2992893a71ac0ee3f43477000176"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u32 magic</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="paging_8c_source.html#l00283">283</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3337b35daceb6ab9c5edf3bf526e469a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">u32 nframes</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="paging_8c_source.html#l00014">14</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3664686d7e92f0bca2061d088362f3d8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">u32 prealloc_frames[20]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="paging_8c_source.html#l00013">13</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>

</div>
</div>
<a class="anchor" id="acfd6273064c5acdcfc39a23a69dd4343"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u32 size</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="paging_8c_source.html#l00282">282</a> of file <a class="el" href="paging_8c_source.html">paging.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_dc43877d82dd332f9fb2071fcca799d6.html">kernel</a></li><li class="navelem"><a class="el" href="dir_4a04b9aac4eefdd334a78e565f4616f2.html">arch</a></li><li class="navelem"><a class="el" href="dir_0ce8714634557e35558d1ff2ffab94d6.html">x86</a></li><li class="navelem"><a class="el" href="dir_7c13a396c62eec3d86490ab07a304f3c.html">mm</a></li><li class="navelem"><a class="el" href="paging_8c.html">paging.c</a></li>
    <li class="footer">Generated on Mon Jan 13 2014 21:41:56 for Lambda OS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
